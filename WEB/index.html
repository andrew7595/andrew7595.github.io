<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>黃柏瑞作品集</title>

<style>
body {
  margin: 0;
  font-family: sans-serif;
  display: flex;
}

/* 左側目錄 */
#sidebar {
  width: 90px;
  background: #f5f5f5;
  padding: 5px;
  overflow-y: auto;
  border-right: 1px solid #ccc;
}

#sidebar button {
  width: auto;
  display: block;
  padding: 4px 6px;
  margin-bottom: 6px;
  font-size: 13px;
  white-space: pre-line; /* 允許你手動換行 */
  border: none;
  background: #e0e0e0;
  border-radius: 6px;
  cursor: pointer;
}

#sidebar button.active {
  background: #2196f3;
  color: white;
}

/* PDF 區 */
#viewerContainer {
  flex: 1;
  height: 100vh;
  overflow-y: auto;
  background: #888;
}

.page {
  margin: 10px auto;
  background: white;
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
  min-height: 800px;
}

canvas {
  width: 100%;
  height: auto;
  display: block;
}

/* 頁碼 */
#pageIndicator {
  position: fixed;
  bottom: 10px;
  right: 15px;
  background: rgba(0,0,0,0.6);
  color: white;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 14px;
}
</style>
</head>

<body>

<div id="sidebar">
    <button data-page="1">封面</button>
    <button data-page="2">自我介紹</button>
    <button data-page="3">工作經歷</button>
    <button data-page="4">專案經歷</button>
    <button data-page="5">展演製作類</button>
    <button data-page="6">侏儸紀大冒險
體感遊戲</button>
    <button data-page="7">絕不低頭-陳篡地傳
文學腳本佳作</button>
    <button data-page="8">台中國家歌劇院-
翩翩、光影鐘WEBVR</button>
    <button data-page="9">台南左鎮化石園區-
投影挖掘、著色紙</button>
    <button data-page="10">台南左鎮化石園區-
互動投影、浮空投影</button>
    <button data-page="11">基隆海科館-
板塊移動學說</button>
    <button data-page="12">基隆海科館-
六大時代AR</button>
    <button data-page="13">台南左鎮化石園區-
沉浸劇場</button>
    <button data-page="14">嘉義博物館-
QA互動螢幕</button>
    <button data-page="15">嘉義博物館-
體感遊戲</button>
    <button data-page="16">新北十三行-
八里時光機</button>
    <button data-page="17">3D製作類</button>
    <button data-page="18">NFT區塊練遊戲</button>
    <button data-page="19">神明系列Q版</button>
    <button data-page="20">室內及建築場景</button>
    <button data-page="21">景美人權園區</button>
    <button data-page="22">手機遊戲製作</button>
    <button data-page="23">3D動畫類</button>
    <button data-page="24">3D裸視製作</button>
    <button data-page="25">科技肥料廠</button>
    <button data-page="26">品酒動畫</button>
    <button data-page="27">虛擬實境、擴增實境類</button>
    <button data-page="28">教育部MR教材</button>
    <button data-page="29">地震、火災逃生訓練</button>
    <button data-page="30">華視兒童周刊</button>
    <button data-page="31">CARDBOARD 
WEBVR</button>
    <button data-page="32">儒鴻湖邊VIP虛擬展間</button>
    <button data-page="33">IOT類</button>
    <button data-page="34">東元電子</button>
    <button data-page="35">微智安聯</button>
    <button data-page="36">感謝閱讀</button>
</div>

<div id="viewerContainer">
  <div id="viewer"></div>
</div>

<div id="pageIndicator">目前頁碼：1</div>

<script type="module">
import * as pdfjsLib from './build/pdf.mjs';
pdfjsLib.GlobalWorkerOptions.workerSrc = './build/pdf.worker.mjs';

const url = './document.pdf';
const viewer = document.getElementById('viewer');
const container = document.getElementById('viewerContainer');
const indicator = document.getElementById('pageIndicator');
const menuButtons = document.querySelectorAll('#sidebar button');

let pdfDoc = null;
let pageDivs = [];
let pageRendered = [];
let resizeTimer = null;
let lastWidth = 0;

/* 計算縮放 */
function getScale(page) {
  const viewport = page.getViewport({ scale: 1 });
  return (container.clientWidth - 20) / viewport.width;
}

/* 懶加載渲染 */
async function renderPageIfNeeded(num) {
  if (pageRendered[num]) return;

  const page = await pdfDoc.getPage(num);
  const scale = getScale(page);
  const viewport = page.getViewport({ scale });

  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  canvas.width = viewport.width;
  canvas.height = viewport.height;

  pageDivs[num - 1].appendChild(canvas);

  await page.render({ canvasContext: ctx, viewport }).promise;

  pageRendered[num] = true;
}

/* 建立容器 */
function setupContainers() {
  viewer.innerHTML = '';
  pageDivs = [];
  pageRendered = [];

  for (let i = 1; i <= pdfDoc.numPages; i++) {
    const div = document.createElement('div');
    div.className = 'page';
    div.dataset.pageNumber = i;
    viewer.appendChild(div);
    pageDivs.push(div);
  }
}

/* 滑動時只渲染可見頁 */
function onScroll() {
  const vh = window.innerHeight;

  pageDivs.forEach((div, i) => {
    const rect = div.getBoundingClientRect();
    if (rect.top < vh * 1.5 && rect.bottom > -vh * 0.5) {
      renderPageIfNeeded(i + 1);
    }
  });

  detectCurrentPage();
}

/* 偵測目前頁 */
function detectCurrentPage() {
  let current = 1;
  let min = Infinity;

  pageDivs.forEach(div => {
    const rect = div.getBoundingClientRect();
    const offset = Math.abs(rect.top);
    if (offset < min) {
      min = offset;
      current = parseInt(div.dataset.pageNumber);
    }
  });

  indicator.textContent = `目前頁碼：${current}`;
  menuButtons.forEach(b => b.classList.toggle('active', parseInt(b.dataset.page) === current));
}

/* 點目錄跳頁 */
menuButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    pageDivs[btn.dataset.page - 1].scrollIntoView({ behavior: 'smooth' });
  });
});

/* resize 防風暴 */
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    if (Math.abs(container.clientWidth - lastWidth) > 50) {
      lastWidth = container.clientWidth;
      pageRendered = [];
      pageDivs.forEach(d => d.innerHTML = '');
      onScroll();
    }
  }, 300);
});

container.addEventListener('scroll', onScroll);

/* 初始化 */
(async () => {
  pdfDoc = await pdfjsLib.getDocument(url).promise;
  setupContainers();
  onScroll();
})();
</script>

</body>
</html>
